drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
start transaction ;
truncate table atomic_table_10;
use transaction_enhance;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
select * from atomic_table_10;
c1    c2
commit;
select * from atomic_table_10;
c1    c2
drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
start transaction ;
truncate table atomic_table_10;
use transaction_enhance;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
select * from atomic_table_10;
c1    c2
rollback;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
begin ;
truncate table atomic_table_10;
use transaction_enhance;
insert into atomic_table_10 values (6,"a"),(7,"b"),(8,"c");
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
6    a
7    b
8    c
select * from atomic_table_10;
c1    c2
commit;
select * from atomic_table_10;
c1    c2
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
drop table atomic_table_11;
use transaction_enhance;
insert into atomic_table_11 values (6,"a");
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
commit;
select * from atomic_table_11;
SQL parser error: table "atomic_table_11" does not exist
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
drop table atomic_table_11;
use transaction_enhance;
insert into atomic_table_11 values (6,"a");
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
rollback ;
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
use transaction_enhance;
drop table atomic_table_11;
drop table atomic_table_11;
SQL parser error: table "atomic_table_11" does not exist
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
commit;
drop table if exists atomic_table_12;
create table atomic_table_12(c1 int,c2 varchar(25));
insert into atomic_table_12 values (3,"a"),(4,"b"),(5,"c");
begin;
alter table atomic_table_12 add index key1(c1);
alter table atomic_table_12 alter index key1 visible;
use transaction_enhance;
show create table atomic_table_12;
Table    Create Table
atomic_table_12    CREATE TABLE `atomic_table_12` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
commit;
show create table atomic_table_12;
Table    Create Table
atomic_table_12    CREATE TABLE `atomic_table_12` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nKEY `key1` (`c1`)\n)
show index from atomic_table_12;
Table    Non_unique    Key_name    Seq_in_index    Column_name    Collation    Cardinality    Sub_part    Packed    Null    Index_type    Comment    Index_comment    Visible    Expression
atomic_table_12    1    key1    1    c1    A    0    NULL    NULL    YES                YES    NULL
use transaction_enhance;
drop table if exists atomic_table_12_1;
create table atomic_table_12_1(c1 int,c2 varchar(25));
insert into atomic_table_12_1 values (3,"a"),(4,"b"),(5,"c");
begin;
alter table atomic_table_12_1 add index key1(c1);
alter table atomic_table_12_1 alter index key1 visible;
use transaction_enhance;
show create table atomic_table_12_1;
Table    Create Table
atomic_table_12_1    CREATE TABLE `atomic_table_12_1` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
rollback;
show create table atomic_table_12_1;
Table    Create Table
atomic_table_12_1    CREATE TABLE `atomic_table_12_1` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
show index from atomic_table_12_1;
Table    Non_unique    Key_name    Seq_in_index    Column_name    Collation    Cardinality    Sub_part    Packed    Null    Index_type    Comment    Index_comment    Visible    Expression
drop table if exists atomic_table_12_2;
drop table if exists atomic_table_13;
create table atomic_table_12_2(c1 int primary key,c2 varchar(25));
insert into atomic_table_12_2 values (3,"a"),(4,"b"),(5,"c");
create table atomic_table_13(c1 int primary key,c2 varchar(25));
Communications link failure

The last packet successfully received from the server was 120,002 milliseconds ago.  The last packet sent successfully to the server was 120,002 milliseconds ago.
insert into atomic_table_13 values (3,"d"),(4,"e"),(5,"f");
no such table .atomic_table_13
begin;
alter table atomic_table_13 add constraint ffa foreign key f_a(c1) references atomic_table_12_2(c1);
no such table .atomic_table_13
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
show create table atomic_table_12_2;
Table    Create Table
atomic_table_12_2    CREATE TABLE `atomic_table_12_2` (\n`c1` INT NOT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nPRIMARY KEY (`c1`)\n)
insert into atomic_table_13 values (8,"h");
no such table transaction_enhance.atomic_table_13
select * from atomic_table_13;
SQL parser error: table "atomic_table_13" does not exist
insert into atomic_table_13 values (6,"h");
no such table .atomic_table_13
commit;
show create table atomic_table_13;
no such table .atomic_table_13
drop table if exists atomic_table_12_3;
drop table if exists atomic_table_13;
create table atomic_table_12_3(c1 int primary key,c2 varchar(25));
not connect to a database
insert into atomic_table_12_3 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_12_3
create table atomic_table_13(c1 int primary key,c2 varchar(25));
not connect to a database
insert into atomic_table_13 values (3,"d"),(4,"e"),(5,"f");
no such table .atomic_table_13
alter table atomic_table_13 add constraint ffa foreign key f_a(c1) references atomic_table_12_3(c1);
no such table .atomic_table_13
begin;
alter table atomic_table_13 drop foreign key ffa;
no such table .atomic_table_13
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into atomic_table_13 values (8,"h");
no such table transaction_enhance.atomic_table_13
select * from atomic_table_13;
SQL parser error: table "atomic_table_13" does not exist
commit;
show create table atomic_table_13;
no such table .atomic_table_13
drop table if exists atomic_table_12_4;
drop table if exists atomic_table_13;
create table atomic_table_12_4(c1 int primary key,c2 varchar(25));
not connect to a database
insert into atomic_table_12_4 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_12_4
create table atomic_table_13(c1 int primary key,c2 varchar(25));
not connect to a database
insert into atomic_table_13 values (3,"d"),(4,"e"),(5,"f");
no such table .atomic_table_13
alter table atomic_table_13 add constraint ffa foreign key f_a(c1) references atomic_table_12_4(c1);
no such table .atomic_table_13
begin;
alter table atomic_table_13 drop foreign key ffa;
no such table .atomic_table_13
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into atomic_table_13 values (8,"h");
no such table transaction_enhance.atomic_table_13
select * from atomic_table_13;
SQL parser error: table "atomic_table_13" does not exist
rollback ;
show create table atomic_table_13;
no such table .atomic_table_13
drop table if exists atomic_table_12_5;
drop table if exists atomic_table_13;
create table atomic_table_12_5(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_12_5 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_12_5
alter table atomic_table_12_5 add index key1(c1);
no such table .atomic_table_12_5
begin;
alter table atomic_table_12_5 drop index key1;
no such table .atomic_table_12_5
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
show create table atomic_table_12_5;
no such table transaction_enhance.atomic_table_12_5
select * from atomic_table_12_5;
SQL parser error: table "atomic_table_12_5" does not exist
commit;
show index from atomic_table_12_5;
not connect to a database
drop table if exists atomic_table_14;
create table atomic_table_14(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_14 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_14
start transaction ;
alter table atomic_table_14 add  index key1(c1);
no such table .atomic_table_14
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
drop table atomic_table_14;
no such table transaction_enhance.atomic_table_14
insert into atomic_table_14 values (6,"a"),(7,"b");
no such table .atomic_table_14
select * from atomic_table_14;
SQL parser error: table "atomic_table_14" does not exist
commit;
select * from atomic_table_14;
SQL parser error: table "atomic_table_14" does not exist
drop table if exists atomic_table_15;
create table atomic_table_15(c1 int,c2 varchar(25));
not connect to a database
begin;
insert into atomic_table_15 values (6,"a"),(7,"b");
no such table .atomic_table_15
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
truncate table atomic_table_15;
no such table .atomic_table_15
use transaction_enhance;
drop table atomic_table_15;
no such table transaction_enhance.atomic_table_15
select * from atomic_table_15;
SQL parser error: table "atomic_table_15" does not exist
commit;
select * from atomic_table_15;
SQL parser error: table "atomic_table_15" does not exist
drop table if exists atomic_table_16;
create table atomic_table_16(c1 int,c2 varchar(25));
not connect to a database
begin;
insert into atomic_table_16 values (6,"a"),(7,"b");
no such table .atomic_table_16
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
drop table atomic_table_16;
no such table .atomic_table_16
use transaction_enhance;
drop table atomic_table_16;
no such table transaction_enhance.atomic_table_16
commit;
select * from atomic_table_16;
SQL parser error: table "atomic_table_16" does not exist
drop table if exists atomic_table_17;
create table atomic_table_17(c1 int,c2 varchar(25));
not connect to a database
begin;
insert into atomic_table_17 values (6,"a"),(7,"b");
no such table .atomic_table_17
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
drop table atomic_table_17;
no such table .atomic_table_17
use transaction_enhance;
alter table atomic_table_17 add constraint unique key (c1);
no such table transaction_enhance.atomic_table_17
update atomic_table_17 set c1=8 where c2="b";
no such table transaction_enhance.atomic_table_17
commit;
select * from atomic_table_17;
SQL parser error: table "atomic_table_17" does not exist
start transaction ;
create database tdb;
use tdb;
invalid database tdb
drop database tdb;
commit;
begin;
create sequence seq_01 as int start 30;
internal error: Only CREATE of DDL is supported in transactions
use transaction_enhance;
select nextval('seq_01');
SQL parser error: table "seq_01" does not exist
commit;
select nextval('seq_01');
ExpectedEOB
drop table if exists atomic_table_11;
drop account if exists trans_acc1;
create account trans_acc1 admin_name "admin" identified by "111";
begin;
drop account trans_acc1;
internal error: administrative command is unsupported in transactions
use transaction_enhance;
select count(*) from mo_catalog.mo_account where account_name='trans_acc1';
count(*)
1
commit;
select count(*) from mo_catalog.mo_account where account_name='trans_acc1';
count(*)
1
drop table if exists atomic_table_18;
create table atomic_table_18(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_18 values (6,"a"),(7,"b");
no such table .atomic_table_18
set autocommit=0;
alter table atomic_table_18 add index key1(c1);
no such table .atomic_table_18
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
alter table atomic_table_18 alter index key1 visible;
no such table .atomic_table_18
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
show create table atomic_table_18;
no such table transaction_enhance.atomic_table_18
rollback;
show create table atomic_table_18;
no such table .atomic_table_18
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
show index from atomic_table_18;
not connect to a database
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
truncate table atomic_table_18;
no such table .atomic_table_18
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
drop table atomic_table_18;
no such table transaction_enhance.atomic_table_18
select * from atomic_table_18;
SQL parser error: table "atomic_table_18" does not exist
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
commit;
select * from atomic_table_18;
SQL parser error: table "atomic_table_18" does not exist
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
set autocommit=1;
drop table if exists atomic_table_18;
create table atomic_table_18(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_18 values (6,"a"),(7,"b");
no such table .atomic_table_18
set autocommit=0;
drop table atomic_table_18;
no such table .atomic_table_18
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
drop table atomic_table_18;
no such table transaction_enhance.atomic_table_18
select * from atomic_table_18;
SQL parser error: table "atomic_table_18" does not exist
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
commit;
select * from atomic_table_18;
SQL parser error: table "atomic_table_18" does not exist
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
set autocommit=1;
drop account if exists trans_acc1;
drop table if exists alter01;
drop table if exists alter02;
create table alter01(col1 int primary key,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 modify col1 float;
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
commit;
select * from alter01;
SQL parser error: table "alter01" does not exist
drop table if exists alter01;
drop table if exists alter02;
create table alter01(col1 int not null ,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 modify col1 float;
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
commit;
select * from alter01;
SQL parser error: table "alter01" does not exist
drop table if exists atomic_table_12_5;
create table atomic_table_12_5(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_12_5 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_12_5
alter table atomic_table_12_5 add index key1(c1);
no such table .atomic_table_12_5
begin;
alter table atomic_table_12_5 change c1 clNew double;
no such table .atomic_table_12_5
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
show create table atomic_table_12_5;
no such table transaction_enhance.atomic_table_12_5
select * from atomic_table_12_5;
SQL parser error: table "atomic_table_12_5" does not exist
show create table atomic_table_12_5;
no such table .atomic_table_12_5
drop table if exists alter01;
create table alter01(col1 int primary key,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 change col1 col1New float;
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
drop table if exists atomic_table_12_5;
create table atomic_table_12_5(c1 int,c2 varchar(25));
not connect to a database
insert into atomic_table_12_5 values (3,"a"),(4,"b"),(5,"c");
no such table .atomic_table_12_5
alter table atomic_table_12_5 add index key1(c1);
no such table .atomic_table_12_5
begin;
alter table atomic_table_12_5 rename column c1 to clNew;
no such table .atomic_table_12_5
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
show create table atomic_table_12_5;
no such table transaction_enhance.atomic_table_12_5
select * from atomic_table_12_5;
SQL parser error: table "atomic_table_12_5" does not exist
show create table atomic_table_12_5;
no such table .atomic_table_12_5
drop table if exists alter01;
create table alter01(col1 int primary key,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 rename column col1 to col1New;
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
drop table if exists alter01;
create table alter01(col1 int,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 add constraint primary key (col1);
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
drop table if exists alter01;
create table alter01(col1 int primary key,col2 varchar(25));
not connect to a database
insert into alter01 values (3,"a"),(4,"b"),(5,"c");
no such table .alter01
begin;
alter table alter01 drop primary key;
no such table .alter01
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
use transaction_enhance;
insert into alter01 values (8,"h");
no such table transaction_enhance.alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
insert into alter01 values (6,"h");
no such table .alter01
select * from alter01;
SQL parser error: table "alter01" does not exist
