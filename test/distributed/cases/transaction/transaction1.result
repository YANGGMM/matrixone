drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
start transaction ;
truncate table atomic_table_10;
use transaction_enhance;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
select * from atomic_table_10;
c1    c2
commit;
select * from atomic_table_10;
c1    c2
drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
start transaction ;
truncate table atomic_table_10;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
select * from atomic_table_10;
c1    c2
rollback;
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
drop table if exists atomic_table_10;
create table atomic_table_10(c1 int,c2 varchar(25));
insert into atomic_table_10 values (3,"a"),(4,"b"),(5,"c");
begin ;
truncate table atomic_table_10;
insert into atomic_table_10 values (6,"a"),(7,"b"),(8,"c");
select * from atomic_table_10;
c1    c2
3    a
4    b
5    c
6    a
7    b
8    c
select * from atomic_table_10;
c1    c2
commit;
select * from atomic_table_10;
c1    c2
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
drop table atomic_table_11;
insert into atomic_table_11 values (6,"a");
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
commit;
select * from atomic_table_11;
SQL parser error: table "atomic_table_11" does not exist
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
drop table atomic_table_11;
insert into atomic_table_11 values (6,"a");
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
rollback ;
select * from atomic_table_11;
c1    c2
3    a
4    b
5    c
6    a
drop table if exists atomic_table_11;
create table atomic_table_11(c1 int,c2 varchar(25));
insert into atomic_table_11 values (3,"a"),(4,"b"),(5,"c");
begin;
drop table atomic_table_11;
drop table atomic_table_11;
commit;
w-w conflict
drop table if exists atomic_table_12;
create table atomic_table_12(c1 int,c2 varchar(25));
insert into atomic_table_12 values (3,"a"),(4,"b"),(5,"c");
begin;
alter table atomic_table_12 add index key1(c1);
alter table atomic_table_12 alter index key1 visible;
show create table atomic_table_12;
Table    Create Table
atomic_table_12    CREATE TABLE `atomic_table_12` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
commit;
show create table atomic_table_12;
Table    Create Table
atomic_table_12    CREATE TABLE `atomic_table_12` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nKEY `key1` (`c1`)\n)
show index from atomic_table_12;
Table    Non_unique    Key_name    Seq_in_index    Column_name    Collation    Cardinality    Sub_part    Packed    Null    Index_type    Comment    Index_comment    Visible    Expression
atomic_table_12    1    key1    1    c1    A    0    NULL    NULL    YES                YES    NULL
use transaction_enhance;
drop table if exists atomic_table_12_1;
create table atomic_table_12_1(c1 int,c2 varchar(25));
insert into atomic_table_12_1 values (3,"a"),(4,"b"),(5,"c");
begin;
alter table atomic_table_12_1 add index key1(c1);
alter table atomic_table_12_1 alter index key1 visible;
show create table atomic_table_12_1;
Table    Create Table
atomic_table_12_1    CREATE TABLE `atomic_table_12_1` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
rollback;
show create table atomic_table_12_1;
Table    Create Table
atomic_table_12_1    CREATE TABLE `atomic_table_12_1` (\n`c1` INT DEFAULT NULL,\n`c2` VARCHAR(25) DEFAULT NULL\n)
show index from atomic_table_12_1;
Table    Non_unique    Key_name    Seq_in_index    Column_name    Collation    Cardinality    Sub_part    Packed    Null    Index_type    Comment    Index_comment    Visible    Expression
use transaction_enhance;
drop table if exists atomic_table_12_2;
drop table if exists atomic_table_13;
create table atomic_table_12_2(c1 int primary key,c2 varchar(25));
insert into atomic_table_12_2 values (3,"a"),(4,"b"),(5,"c");
create table atomic_table_13(c1 int primary key,c2 varchar(25));
insert into atomic_table_13 values (3,"d"),(4,"e"),(5,"f");
begin;
alter table atomic_table_13 add constraint ffa foreign key f_a(c1) references atomic_table_12_2(c1);
show create table atomic_table_12_2;
Table    Create Table
atomic_table_12_2    CREATE TABLE `atomic_table_12_2` (\n`c1` INT NOT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nPRIMARY KEY (`c1`)\n)
insert into atomic_table_13 values (8,"h");
select * from atomic_table_13;
c1    c2
3    d
4    e
5    f
8    h
insert into atomic_table_13 values (6,"h");
internal error: Cannot add or update a child row: a foreign key constraint fails
Previous DML conflicts with existing constraints or data format. This transaction has to be aborted
commit;
show create table atomic_table_13;
Table    Create Table
atomic_table_13    CREATE TABLE `atomic_table_13` (\n`c1` INT NOT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nPRIMARY KEY (`c1`)\n)
drop table if exists atomic_table_12_3;
drop table if exists atomic_table_13;
create table atomic_table_12_3(c1 int primary key,c2 varchar(25));
insert into atomic_table_12_3 values (3,"a"),(4,"b"),(5,"c");
create table atomic_table_13(c1 int primary key,c2 varchar(25));
insert into atomic_table_13 values (3,"d"),(4,"e"),(5,"f");
alter table atomic_table_13 add constraint ffa foreign key f_a(c1) references atomic_table_12_3(c1);
begin;
alter table atomic_table_13 drop foreign key ffa;
insert into atomic_table_13 values (8,"h");
internal error: Cannot add or update a child row: a foreign key constraint fails
select * from atomic_table_13;
c1    c2
3    d
4    e
5    f
commit;
show create table atomic_table_13;
Table    Create Table
atomic_table_13    CREATE TABLE `atomic_table_13` (\n`c1` INT NOT NULL,\n`c2` VARCHAR(25) DEFAULT NULL,\nPRIMARY KEY (`c1`)\n)